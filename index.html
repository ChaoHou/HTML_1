<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>App</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
	<style>
	text{
		pointer-events:none;
		cursor:pointer;
	}
	
	</style>
  </head>
  <body>
  <script>
    
    var teams =  [{"text":"Adelaide Thunderbirds"},
                  {"text":"Canterbury Tactix"},
                  {"text":"Central Pulse"},
                  {"text":"Melbourne Vixens"},
                  {"text":"New South Wales Swifts"},
                  {"text":"Northern Mystics"},
                  {"text":"Queensland Firebirds"},
                  {"text":"Southern Steel"},
                  {"text":"Waikato Bay of Plenty Magic"},
                  {"text":"West Coast Fever"}];
    initArray(teams,"red");
       
    var contries = [{"text":"New Zealand"},
                    {"text":"Australian"}];
    initArray(contries,"blue");
  
    var venues = [{"text":"Adelaide Arena, Adelaide"},
                  {"text":"Arena Manawatu, Palmerston North"},
                  {"text":"Brisbane Convention and Exhibition Centre"},
                  {"text":"Challenge Stadium, Perth"},
                  {"text":"ETSA Park, Adelaide"},
                  {"text":"Energy Events Centre, Rotorua"},
                  {"text":"Hisense Arena, Melbourne"},
                  {"text":"Mystery Creek Events Centre, Hamilton"},
                  {"text":"North Shore Events Centre, Auckland"},
                  {"text":"Queen Elizabeth Youth Centre, Tauranga"},
                  {"text":"Stadium Southland, Invercargill"},
                  {"text":"State Netball and Hockey Centre, Melbourne"},
                  {"text":"Sydney Olympic Park Sports Centre"},
                  {"text":"TSB Bank Arena, Wellington"},
                  {"text":"Te Rauparaha Arena, Porirua"},
                  {"text":"The Edgar Centre, Dunedin"},
                  {"text":"Trusts Stadium, Auckland"},
                  {"text":"Westpac Arena, Christchurch"}];
    initArray(venues,"green");
    
    var data = teams.concat(contries,venues);
    
    var height = 700, width = 1200, poolWidth = 100, isStart = false;
    var svg = d3.select("body")
                .append("svg")
                .attr("height",height)
                .attr("width",width);
    var pool = svg.append("rect")
    		.attr("x",0)
    		.attr("y",0)
    		.attr("fill","yellow")
    		.attr("width",poolWidth)
    		.attr("height",height)
			.on("click",showDetails);
	
    var force = d3.layout.force()
                          .nodes(data)
                          .links([])
                          .size([width,height])
                          .linkDistance([80])
                          .charge([-1200])
                          .gravity(0.3)
                          .start();
    
    var nodes = svg.selectAll("circle")
			.data(data)
			.enter()
			.append("circle")
			.attr("r",40)
			.style("fill",function(d){return d.color})
			.call(force.drag)
			.on("mousedown",function(){isStart = true;});
    
    var gs = svg.selectAll("g")
		.data(data)
		.enter()
		.append("g");
    var arc = d3.svg.arc()
		.innerRadius(function(d,i){return 30;})
		.outerRadius(function(d,i){return 40;})
		.startAngle(-Math.PI*0.5)
		.endAngle(Math.PI*1.4);
    var arcs = gs.append("path")
		.attr('fill-opacity', '0')
		.attr("id", function(d,i){return "s"+i;})
		.attr("d",arc);
    gs.append("text")
	.style("font-size",10)
	.attr("dy",function(d,i){return 10;})
	.append("textPath")
	.attr("textLength",function(d,i){return 180 ;})
	.attr("xlink:href",function(d,i){return "#s"+i;})
	.attr("startOffset",'0%')
	.attr("fill","white")
	.text(function(d){return d.text;})
	
    force.on("tick", function(e){
      nodes.each(function(d){
		if(d.x<100 && isStart){
			d.x += (50-d.x)*0.8;
		}
	  })
			.attr("cx",function(d){return d.x;})
            .attr("cy",function(d){return d.y;});
      gs.attr("transform", function(d){return "translate("+d.x+","+d.y+")";});
    })
	
    function initArray(data,color){
      for(var i=0;i<data.length;i++){
        data[i].color = color;
      }
      return data;
    }
    
	var Pad = function(container){
		this.background = container.append("rect")
									.attr("x",0)
									.attr("y",0)
									.attr("fill","white")
									.attr("width",width)
									.attr("height",height)
									.attr("id","background")
									.style("display","none");
									
		this.closeButton = container.append("circle")
									.attr("cx",width-200)
									.attr("cy",100)
									.attr("r",20)
									.attr("id","closeButton")
									.attr("fill","red")
									.style("display","none")
									.on("mousedown",function(){
										document.getElementById("closeButton").style.display = "none";
										document.getElementById("background").style.display = "none"
									});
		
		this.open = function(){
			this.background.style("display","block");
			this.closeButton.style("display","block");
		};
		
		this.close = function(){
			this.background.style("display","none");
			this.closeButton.style("display","none");
		};
	};
	
	
	var pad = new Pad(svg);
	
	function showDetails(){
		pad.open();
	}
    
  </script>
  </body>
</html>
